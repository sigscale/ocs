<!--  vim: set ts=3:  -->
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="i18n-msg/i18n-msg.html">
<link rel="import" href="i18n-msg/i18n-msg-behavior.html">
<link rel="import" href="iron-ajax/iron-ajax.html">
<link rel="import" href="iron-collapse/iron-collapse.html">
<link rel="import" href="paper-dialog/paper-dialog.html">
<link rel="import" href="paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="paper-listbox/paper-listbox.html">
<link rel="import" href="paper-toolbar/paper-toolbar.html">
<link rel="import" href="paper-input/paper-input.html">
<link rel="import" href="paper-button/paper-button.html">
<link rel="import" href="paper-tooltip/paper-tooltip.html">
<link rel="import" href="paper-toggle-button/paper-toggle-button.html" >
<link rel="import" href="paper-toast/paper-toast.html">
<link rel="import" href="paper-styles/color.html">
<link rel="import" href="paper-date-picker/paper-date-picker.html">

<dom-module id="sig-product-add">
	<style is="custom-style">
		paper-dialog {
			overflow: auto;
		}
		paper-item {
			padding-right: 10px;
		}
		paper-toolbar{
			margin-top: 0px;
			color: white;
			background-color: #bc5100;
		}
		paper-toast.error {
			background-color: var(--paper-red-a400);
		}
		.add-button {
			background-color: var(--paper-lime-a700);
			color: black;
			width: 8em;
		}
		.cancel-button {
			color: black;
		}
		.close {
			background-color: var(--paper-lime-a700);
			color: black;
			float: right;
			width: 5em;
		}
	</style>
	<template>
		<paper-dialog id="addProductModal" modal>
			<paper-toolbar>
				<paper-tabs selected="{{selected}}">
					<paper-tab id="offer-add">
						<h2>[[i18n.offer]]</h2>
					</paper-tab>
					<paper-tab id="price-add">
						<h2>[[i18n.prices]]</h2>
					</paper-tab>
					<paper-tab id="alt-add">
						<h2>[[i18n.alter]]</h2>
					</paper-tab>
				</paper-tabs>
			</paper-toolbar>
			<iron-pages selected="{{selected}}">
				<div id="addOff-tab">
					<div>
						<paper-input id="addOffName"
								class="name"
								name="name"
								label="[[i18n.name]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerNameTool">
								Product Offering name
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addOffDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerDesTool">
								Product Offering description
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductStartDatePickOff">
							<paper-date-picker id="startOff3" date="{{addProductStartDateOfferPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addOffStart"
								value="[[addProductStartDateOffer]]"
								name="addProductStartDateOffer"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerStartTool">
								Product Offering start date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickOff">
							<paper-date-picker id="endOff3" date="{{addProductEndDateOfferPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addOffEnd"
								value="[[addProductEndDateOffer]]"
								name="addProductEndDateOffer"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickOff.hide(); addProductEndDatePickOff.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerEndTool">
								Product Offering end date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addOffer">
								<i18n-msg msgid="submit">
									Submit
								</i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id=addPrice-tab>
					<div>
						<datalist id="price">
							<template is="dom-repeat" items="[[prices]]">
								<option value="{{item.name}}" />
							</template>
						</datalist>
						<paper-input id="addPriceName" 
								list="price"
								label="[[i18n.name]]"
								on-change="updatePriceDialog"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="addPriceNameTool">
								Product offering price name
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceDesTool">
								Product Offering price description
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductStartDatePickPrice">
							<paper-date-picker id="addPriceStart" date="{{addProductStartDatePricePick}}" headingFormat="dd, MMM D">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addPriceStartDate"
								value="[[addProductStartDatePrice]]"
								name="addProductStartDatePrice"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceStartTool">
								Product Offering price start date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickPrice">
							<paper-date-picker id="addPriceEnd" date="{{addProductEndDatePricePick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addPriceEndDate"
								value="[[addProductEndDatePrice]]"
								name="addProductEndDatePrice"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickPrice.hide(); addProductEndDatePickPrice.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceEndTool">
								Product offering price end date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPriceTypedrop"
								label="[[i18n.priceType]]"
								on-selected-item-changed="checkRecure"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPriceType"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item>
									Recurring
								</paper-item>
								<paper-item>
									One Time
								</paper-item>
								<paper-item>
									Usage
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceTypeTool">
								Product offering type of price
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceSize"
								class="size"
								name="size"
								type="text"
								allowed-pattern="[0-9kmg]"
								pattern="^[0-9]+[kmg]?$"
								label="[[i18n.unitSize]]"
								auto-validate
								value=1
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceSizeTool">
								Product offering price unit size
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPriceUnitsdrop"
								label="[[i18n.unit]]"
								on-selected-item-changed="checkPattern"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPriceUnits"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item id="priceBytes">
									 <i18n-msg msgid="octet">
										bytes
									</i18n-msg>
								</paper-item>
								<paper-item id="priceCents">
									<i18n-msg msgid="cent">
										cents
									</i18n-msg>
								</paper-item>
								<paper-item id="priceSeconds">
									<i18n-msg msgid="second">
										seconds
									 </i18n-msg>
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceUnitTool">
								Product offering price units
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceAmount"
								class="amount"
								name="amount"
								type="number"
								label="[[i18n.amount]]"
								value=0
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceAmountTool">
								Product offering price amount
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceCurrency"
								class="currency"
								name="currency"
								label="[[i18n.currency]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceCurrencyTool">
								Product offering price currency
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPricePerioddrop"
								label="[[i18n.period]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPricePeriod"
									slot="dropdown-content"
									class="dropdown-content"
									selected="2">
								<paper-item>
									Daily
								</paper-item>
								<paper-item>
									Weekly
								</paper-item>
								<paper-item>
									Monthly
								</paper-item>
								<paper-item>
									Yearly
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="pricePeriodTool">
								Product offering price period
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								id="addPriceDrop"
								label="[[i18n.alter]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									slot="dropdown-content"
									class="dropdown-content">
									<template is="dom-repeat" items="[[alterations]]">
										<paper-item>
											{{item.name}}
										</paper-item>
									</template>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceAlterTool">
								add alteration to product offering price
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addPrice">
								<i18n-msg msgid="add">
									Add
								</i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id="add-Alt-tab">
					<div>
						<datalist id="alts">
							<template is="dom-repeat" items="[[alterations]]">
								<option value="{{item.name}}" />
							</template>
						</datalist>
						<paper-input id="addAltName" 
								list="alts" 
								label="[[i18n.name]]" 
								on-change="updateAltsDialog">
						</paper-input>
						<paper-tooltip>
								product offering alteration name
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration description
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductStartDatePickAlt">
							<paper-date-picker id="startAlt3" date="{{addProductStartDateAltPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addAltStartDate"
								value="[[addProductStartDateAlt]]"
								name="addProductStartDateAlt"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.show();">
						</paper-input>
						<paper-tooltip>
								product offering alteration start date
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickAlt">
							<paper-date-picker id="endAlt3" date="{{addProductEndDateAltPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addAltEndDate"
								value="[[addProductEndDateAlt]]"
								name="addProductEndDateAlt"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickAlt.hide(); addProductEndDatePickAlt.show();">
						</paper-input>
						<paper-tooltip>
								product offering alteration end date
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								label="[[i18n.priceType]]"
								on-selected-item-changed="checkRecureAlt"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
							<paper-listbox
									id="addAltType"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item>
									Recurring
								</paper-item>
								<paper-item>
									One Time
								</paper-item>
								<paper-item>
									Usage
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration price type
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltSize"
								class="size"
								name="size"
								label="[[i18n.unitSize]]"
								type="text"
								allowed-pattern="[0-9kmg]"
								pattern="^[0-9]+[kmg]?$"
								auto-validate
								value=1
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration size
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								label="[[i18n.unit]]">
							<paper-listbox
									id="addUnitDrop"
									on-selected-item-changed="checkPatternAlt"
									slot="dropdown-content"
									class="dropdown-content">
									<paper-item id="altBytes">
										<i18n-msg msgid="octet">
											bytes
										</i18n-msg>
									</paper-item>
									<paper-item id="altCents">
										<i18n-msg msgid="cent">
											cents
										</i18n-msg>
									</paper-item>
									<paper-item id="altSeconds">
										<i18n-msg msgid="second">
											Seconds
										</i18n-msg>
									</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration units
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltAmount"
								class="amount"
								name="amount"
								label="[[i18n.amount]]"
								type="number"
								value=0
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration amount
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltCurr"
								class="currency"
								name="currency"
								label="[[i18n.currency]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration currency
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addalt5drop"
								label="[[i18n.period]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
							<paper-listbox
									id="addaltPeriod"
									slot="dropdown-content"
									class="dropdown-content"
									selected="2">
								<paper-item>
									Daily
								</paper-item>
								<paper-item>
									Weekly
								</paper-item>
								<paper-item>
									Monthly
								</paper-item>
								<paper-item>
									Yearly
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration period
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addAlteration">
								<i18n-msg msgid="add">
									Add
								<i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
			</iron-pages>
			<paper-toast
					id="addProductToastError">
			</paper-toast>
		</paper-dialog>
		<iron-ajax
				id="addProductAjax"
				url="/catalogManagement/v1/productOffering"
				method = "POST"
				content-type="application/json"
				on-loading-changed="_onLoadingChanged"
				on-response="_addProductResponse"
				on-error="_addProductError">
		</iron-ajax>
	</template>
	<script>
		Polymer ({
			is: 'sig-product-add',
			behaviors: [i18nMsgBehavior],
			properties: {
				alterations: {
					type: Array,
					value: function() {
						return [];
					}
				},
				prices: {
					type: Array,
					value: function() {
						return [];
					}
				},
				selected: {
					type: Number,
					value: 0
				},
				addProductStartDateOffer: {
					type: String,
					value: ""
				},
				addProductEndDateOffer: {
					type: String,
					value: ""
				},
				addProductStartDatePrice: {
					type: String,
					value: ""
				},
				addProductEndDatePrice: {
					type: String,
					value: ""
				},
				addProductStartDateAlt: {
					type: String,
					value: ""
				},
				addProductEndDateAlt: {
					type: String,
					value: ""
				},
				addProductStartDateOfferPick: {
					observer: '_addProductStartDateOfferPick'
				},
				addProductEndDateOfferPick: {
					observer: '_addProductEndDateOfferPick'
				},
				addProductStartDatePricePick: {
					observer: '_addProductStartDatePricePick'
				},
				addProductEndDatePricePick: {
					observer: '_addProductEndDatePricePick'
				},
				addProductStartDateAltPick: {
					observer: '_addProductStartDateAltPick'
				},
				addProductEndDateAltPick: {
					observer: '_addProductEndDateAltPick'
				}
			},
			_addProductStartDateOfferPick: function(date) {
				if (this.$.addProductStartDatePickOff.opened) {
					this.addProductStartDateOffer = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDateOfferPick: function(date) {
				if (this.$.addProductEndDatePickOff.opened) {
					this.addProductEndDateOffer = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductStartDatePricePick: function(date) {
				if (this.$.addProductStartDatePickPrice.opened) {
					this.addProductStartDatePrice = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDatePricePick: function(date) {
				if (this.$.addProductEndDatePickPrice.opened) {
					this.addProductEndDatePrice = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductStartDateAltPick: function(date) {
				if (this.$.addProductStartDatePickAlt.opened) {
					this.addProductStartDateAlt = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDateAltPick: function(date) {
				if (this.$.addProductEndDatePickAlt.opened) {
					this.addProductEndDateAlt = moment(date).format('YYYY-MM-DD');
				}
			},
			updatePriceDialog: function() {
				function checkPriceName(price) {
					return price.name == this.addPriceName.value; 
				}
				var indexPrice = this.prices.findIndex(checkPriceName);
				if (indexPrice == -1) {
					this.$.addPriceDesc.value = null;
					this.$.addPriceType.value = null;
					this.$.addPriceSize.value = null;
					this.$.addPriceAmount.value = null;
				} else {
					this.$.addPriceDesc.value = this.prices[indexPrice].description;
					this.$.addPriceStartDate.value = this.prices[indexPrice].start;
					this.$.addPriceEndDate.value = this.prices[indexPrice].end;
					this.$.addPriceType.value = this.prices[indexPrice].type;
					this.$.addPriceUnits.value = this.prices[indexPrice].unit;
					this.$.addPriceSize.value = this.prices[indexPrice].size;
					this.$.addPriceAmount.value = this.prices[indexPrice].amount;
				}
			},
			updateAltsDialog: function() {
				function checkName(alts) {
					return alts.name == this.addAltName.value; 
				}
				var index = this.alterations.findIndex(checkName);
				if (index == -1) {
					this.$.addAltDesc.value = null;
					this.$.addAltType.value = null;
					this.$.addAltSize.value = null;
					this.$.addAltAmount.value = null;
				} else {
					this.$.addAltDesc.value = this.alterations[index].description;
					this.$.addAltStartDate.value = this.alterations[index].startdate;
					this.$.addAltEndDate.value = this.alterations[index].terminationDate;
					this.$.addAltType.value = this.alterations[index].type;
					this.$.addUnitDrop.value = this.alterations[index].units;
					this.$.addAltSize.value = this.alterations[index].size;
					this.$.addAltAmount.value = this.alterations[index].amount;
				}
			},
			addOffer: function() {
				var offerNew = new Object();
				if(this.$.addOffName.value != null && this.$.addOffName.value != "") {
					offerNew.name = this.$.addOffName.value;
				}
				if(this.$.addOffDesc.value != null && this.$.addOffDesc.value != "") {
					offerNew.description = this.$.addOffDesc.value;
				}
				var startDateTime;
				var endDateTime;
				if(this.$.addOffStart.value != null && this.$.addOffStart.value != "") {
					startDateTime = this.$.addOffStart.value;
				}
				if(this.$.addOffEnd.value != null && this.$.addOffEnd.value != "") {
					endDateTime = this.$.addOffEnd.value;
				}
				if(startDateTime != null && endDateTime != null) {
					offerNew.validFor = {startDateTime, endDateTime};
				} else if(startDateTime != null && endDateTime == null) {
					offerNew.validFor = {startDateTime};
				} else if(startDateTime == null && endDateTime != null) {
					offerNew.validFor = {endDateTime};
				}
				function mapPrice(item) {
					var out = new Object();
					if(item.name != null && item.name != "") {
						out.name = item.name;
					}
					if(item.description != null && item.description != "") {
						out.description = item.description;
					}
					var startDateTime;
					var endDateTime;
					if(item.start != null && item.start != "") {
						startDateTime = item.start;
					}
					if(item.end != null && item.end != "") {
						endDateTime = item.end;
					}
					if(startDateTime != null && endDateTime != null) {
						out.validFor = {startDateTime, endDateTime};
					} else if(startDateTime != null && endDateTime == null) {
						out.validFor = {startDateTime};
					} else if(startDateTime == null && endDateTime != null) {
						out.validFor = {endDateTime};
					}
					if(item.type != null && item.type != "") {
						out.priceType = item.type;
					}
					if(item.unit != null && item.unit != ""
							&& item.size != null
							&& item.size != "") {
						var len = item.size.length; 
						var m = item.size.charAt(len - 1);
						var s = item.size.slice(0, (len - 1));
						if(item.unit == "b") {
							if (m == "m") {
								out.unitOfMeasure = s + "000000b";
							} else if(m == "g") {
								out.unitOfMeasure = s + "000000000b";
							} else if(m == "k") {
								out.unitOfMeasure = s + "000b";
							} else {
								out.unitOfMeasure = item.size;
							}
						} else if(item.unit == "c"){
							out.unitOfMeasure = item.size + "c";
						} else if(item.unit == "s") {
							var n = Number(s);
							if(m == "m") {
								n = n * 60;
								out.unitOfMeasure = n.toString();
							} else if(m == "h") {
								n = n * 3600;
								out.unitOfMeasure = n.toString();
							} else {
								out.unitOfMeasure = item.size;
							}
						}
					}
					var taxIncludedAmount;
					var currencyCode;
					if(item.amount != null && item.amount != "") {
						taxIncludedAmount = item.amount;
					}
					if(item.currency != null && item.currency != "") {
						currencyCode = item.currency;
					}
					if(taxIncludedAmount != null && currencyCode != null) {
						out.price = {taxIncludedAmount, currencyCode};
					} else if (taxIncludedAmount != null && currencyCode == null) {
						out.price = {taxIncludedAmount};
					} else if (taxIncludedAmount == null && currencyCode != null) {
						out.price = {currencyCode};
					}
					if(item.period != null && item.period != "") {
						out.recurringChargePeriod = item.period;
					}
					if(item.alterations != null && item.alterations != "") {
						out.productOfferPriceAlteration = new Object(); 
						if(item.alterations.name != null 
								&& item.alterations.name != "") {
							out.productOfferPriceAlteration.name = item.alterations.name;
						}
						if (item.alterations.description != null
								&& item.alterations.description != "") {
							out.productOfferPriceAlteration.description = item.alterations.description;
						}
						var startDateTime;
						var endDateTime;
						if (item.alterations.startdate != null
								&& item.alterations.startdate != "") {
							startDateTime = item.alterations.startdate;
						}
						if (item.alterations.terminationDate != null
								&& item.alterations.terminationDate != "") {
							endDateTime = item.alterations.terminationDate;
						}
						if (startDateTime != null && endDateTime != null) {
							out.productOfferPriceAlteration.validFor = {startDateTime, endDateTime}
						} else if(startDateTime != null && endDateTime == null) {
							out.productOfferPriceAlteration.validFor = {startDateTime};
						} else if(startDateTime == null && endDateTime != null) {
							out.productOfferPriceAlteration.validFor = {endDateTime};
						}
						if (item.alterations.type != null
								&& item.alterations.type != "") {
							out.productOfferPriceAlteration.priceType = item.alterations.type;
						}
						if (item.alterations.unit != null && item.alterations.unit != ""
								&& item.alterations.size != null && item.alterations.size != "") {
							var len1 = item.alterations.size.length;
							var m1 = item.alterations.size.charAt(len - 1);
							var s1 = item.alterations.size.slice(0, (len - 1));
							if(item.alterations.unit == "b") {
								if (m1 == "m") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000b";
								} else if(m1 == "g") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000000b";
								} else if(m1 == "k") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000b";
								} else {
									out.productOfferPriceAlteration.unitOfMeasure = item.alterations.size;
								}
							} else if(item.alterations.unit == "c"){
								out.alterations.unitOfMeasure = item.size + "c";
							} else if(item.alterations.unit == "s") {
								var n1 = Number(s1);
								if(m1 == "m") {
									n1 = n1 * 60;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else if(m1 == "h") {
									n1 = n1 * 3600;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else {
									out.productOfferPriceAlterationunitOfMeasure = item.alterations.size;
								}
							}
						}
						var taxIncludedAmount;
						var currencyCode
						if (item.alterations.amount != null
								&& item.alterations.amount != "") {
							taxIncludedAmount = item.alterations.amount;
						}
						if (item.alterations.currency != null
								&& item.alterations.currency != "") {
							currencyCode = item.alterations.currency;
						}
						if(taxIncludedAmount != null && currencyCode != null) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount, currencyCode};
						} else if (taxIncludedAmount != null && currencyCode == null) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount};
						} else if (taxIncludedAmount == null && currencyCode != null) {
							out.productOfferPriceAlteration.price = {currencyCode};
						}
						if (item.alterations.period != null
								&& item.alterations.period != "") {
							out.productOfferPriceAlteration.recurringChargePeriod = item.alterations.period;
						}
					}
					return out; 
				}
				offerNew.productOfferingPrice = this.prices.map(mapPrice);
				if(offerNew.name && offerNew.name !== null 
						&& offerNew.productOfferingPrice
						&& offerNew.productOfferingPrice.length > 0) {
					var ajax = this.$.addProductAjax;
					ajax.body = offerNew;
					ajax.generateRequest();
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			checkPattern: function() {
				if(this.$.addPriceUnits.selected == 0) {
					this.$.addPriceSize.allowedPattern = "[0-9kmg]";
					this.$.addPriceSize.pattern = "^[0-9]+[kmg]?$";
				} else if(this.$.addPriceUnits.selected == 1) {
					this.$.addPriceSize.allowedPattern = "[0-9]";
					this.$.addPriceSize.pattern = "^[0-9]+$";
				} else if(this.$.addPriceUnits.selected == 2) {
					this.$.addPriceSize.allowedPattern = "[0-9mh]";
					this.$.addPriceSize.pattern = "^[0-9]+[mh]?$";
				}
			},
			checkPatternAlt: function() {
				if(this.$.addUnitDrop.selected == 0) {
					this.$.addAltSize.allowedPattern = "[0-9kmg]";
					this.$.addAltSize.pattern = "^[0-9]+[kmg]?$";
				} else if(this.$.addUnitDrop.selected == 1) {
					this.$.addAltSize.allowedPattern = "[0-9]";
					this.$.addAltSize.pattern = "^[0-9]+$";
				} else if(this.$.addUnitDrop.selected == 2) {
					this.$.addAltSize.allowedPattern = "[0-9mh]";
					this.$.addAltSize.pattern = "^[0-9]+[mh]?$";
				}
			},
			checkRecure: function() {
				if(this.$.addPriceType.selected == 0) {
					this.$.addPricePerioddrop.disabled = false;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
					this.$.addPriceUnits.selected = 1;
				} else if(this.$.addPriceType.selected == 1) {
					this.$.addPricePerioddrop.disabled = true;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
					this.$.addPriceUnits.selected = 1;
				} else if(this.$.addPriceType.selected == 2) {
					this.$.addPricePerioddrop.disabled = true;
					this.$.priceCents.disabled = true;
					this.$.priceBytes.disabled = false;
					this.$.priceSeconds.disabled = false;
					this.$.addPriceUnits.selected = 0;
				}
			},
			checkRecureAlt: function() {
				if(this.$.addAltType.selected == 0) {
					this.$.addalt5drop.disabled = false;
					this.$.altBytes.disabled = true;
					this.$.altSeconds.disabled = true;
					this.$.altCents.disabled = false;
					this.$.addUnitDrop.selected = 1;
				} else if(this.$.addAltType.selected == 1) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = true;
					this.$.altSeconds.disabled = true;
					this.$.altCents.disabled = false;
					this.$.addUnitDrop.selected = 1;
				} else if(this.$.addAltType.selected == 2) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = false;
					this.$.altSeconds.disabled = false;
					this.$.altCents.disabled = true;
					this.$.addUnitDrop.selected = 0;
				}
			},
			addPrice: function(event) {
				var priceNew = new Object();
				priceNew.name = this.$.addPriceName.value;
				priceNew.description = this.$.addPriceDesc.value;
				priceNew.start = this.$.addPriceStartDate.value;
				priceNew.end = this.$.addPriceEndDate.value;
				switch(this.$.addPriceType.selected) {
					case 0:
						priceNew.type = "recurring";
						break;
					case 1:
						priceNew.type = "one_time";
						break;
					case 2:
						priceNew.type = "usage";
				}
				switch(this.$.addPriceUnits.selected) {
					case 0:
						priceNew.unit = "b";
						break;
					case 1:
						priceNew.unit = "c";
						break;
					case 2:
						priceNew.unit = "s";
				}
				priceNew.amount = parseInt(this.$.addPriceAmount.value);
				priceNew.size = this.$.addPriceSize.value;
				priceNew.currency = this.$.addPriceCurrency.value;
				switch(this.$.addPricePeriod.selected) {
					case 0:
						priceNew.period = "daily";
						break;
					case 1:
						priceNew.period = "weekly";
						break;
					case 2:
						priceNew.period = "monthly";
						break
					case 3:
						priceNew.period = "yearly";
				}
				function checkAlt(alts) {
					return alts.name == this.addPriceDrop.value; 
				}
				var altIndex = this.alterations.findIndex(checkAlt);
				priceNew.alterations = this.alterations[altIndex];
				if(priceNew.name
						&& priceNew.name !== null
						&& priceNew.amount 
						&& priceNew.amount !== null 
						&& priceNew.type
						&& priceNew.type !== null
						&& priceNew.unit 
						&& priceNew.unit !== null) {
					this.push('prices', priceNew);
					this.$.addPriceName.value = null;
					this.$.addPriceDesc.value = null;
					this.$.addPriceStartDate.value = null;
					this.$.addPriceSize.value = null;
					this.$.addPriceAmount.value = null;
					this.$.addPriceUnits.value = null;
					this.$.addPriceEndDate.value = null;
					this.$.addPriceType.value = null;
					this.$.addPriceCurrency.value = null;
					this.$.addPricePeriod.value = null;
					document.getElementById("addProductToastSuccess").open();
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			addAlteration: function() {
				var altNew = new Object();
				altNew.name = this.$.addAltName.value;
				altNew.description = this.$.addAltDesc.value;
				altNew.startdate = this.$.addAltStartDate.value;
				altNew.terminationDate = this.$.addAltEndDate.value;
				switch(this.$.addAltType.selected) {
					case 0:
						altNew.type = "recurring";
						break;
					case 1:
						altNew.type = "one_time";
						break;
					case 2:
						altNew.type = "usage";
				}
				switch(this.$.addUnitDrop.selected) {
					case 0:
						altNew.unit = "b";
						break;
					case 1:
						altNew.unit = "c";
						break
					case 2:
						altNew.unit = "s";
				}
				altNew.size = this.$.addAltSize.value;
				switch(this.$.addaltPeriod.selected) {
					case 0:
						altNew.period = "daily";
						break;
					case 1:
						altNew.period = "weekly";
						break;
					case 2:
						altNew.period = "monthly";
						break
					case 3:
						altNew.period = "yearly";
				}
				altNew.currency = this.$.addAltCurr.value;
				altNew.amount= parseInt(this.$.addAltAmount.value);
				if(altNew.name
						&& altNew.name !== null
						&& altNew.type
						&& altNew.type !== null
						&& altNew.unit
						&& altNew.unit !== null
						&& altNew.size
						&& altNew.size !== null
						&& altNew.amount
						&& altNew.amount !== null) {
					this.push('alterations', altNew);
					this.$.addAltName.value = null
					this.$.addAltDesc.value = null;
					this.$.addAltStartDate.value = null;
					this.$.addAltEndDate.value = null;
					this.$.addAltType.value = null;
					this.$.addAltSize.value = null;
					this.$.addAltCurr.value = null;
					this.$.addAltAmount.value = null;
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			_onLoadingChanged: function(event) {
				if (this.$.addProductAjax.loading) {
					document.getElementById("progress").disabled = false;
				} else {
					document.getElementById("progress").disabled = true;
				}
			},
			_addProductResponse: function(event) {
				this.$.addProductModal.close();
				document.getElementById("addProductToastSuccess").open();
				this.$.addOffName.value = null;
				this.$.addOffDesc.value = null;
				this.set('prices', []);
				this.set('alterations', []);
				document.getElementById("productGrid").clearCache();
			},
			_addProductError: function(event) {
				this.$.addProductToastError.text = event.detail.request.xhr.statusText;
				this.$.addProductToastError.open();
			},
			cancelDialog: function() {
				this.set('prices', []);
				this.set('alterations', []);
				this.$.addOffName.value = null;
				this.$.addOffDesc.value = null;
				this.$.addOffStart.value = null;
				this.$.addOffEnd.value = null;
				this.$.addProductStartDatePickOff.hide()
				this.$.addProductEndDatePickOff.hide()
				this.$.addProductStartDatePickPrice.hide();
				this.$.addProductEndDatePickPrice.hide();
				this.$.addProductStartDatePickAlt.hide();
				this.$.addProductEndDatePickAlt.hide();
				this.$.addProductModal.close();
			}
		});
	</script>
</dom-module>
