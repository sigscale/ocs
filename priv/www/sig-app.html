<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-styles/typography.html">
<link rel="import" href="bower_components/paper-styles/paper-styles.html" />
<link rel="import" href="bower_components/paper-item/paper-item.html" />
<link rel="import" href="bower_components/paper-menu/paper-menu.html"/>
<link rel="import" href="bower_components/paper-menu/paper-submenu.html" />
<link rel="import" href="bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-styles/typography.html">
<link rel="import" href="bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="bower_components/app-route/app-location.html">
<link rel="import" href="bower_components/app-route/app-route.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/iron-selector/iron-selector.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-icons/communication-icons.html">
<link rel="import" href="bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="bower_components/iron-icons/device-icons.html">
<link rel="import" href="bower_components/iron-icons/notification-icons.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="sig-sub-add.html">
<link rel="import" href="sig-sub-list.html">
<link rel="import" href="sig-sub-update.html">
<link rel="import" href="sig-client-add.html">
<link rel="import" href="sig-client-list.html">
<link rel="import" href="sig-client-update.html">
<link rel="import" href="sig-ipdr-list.html">
<link rel="import" href="sig-ipdr-log-files.html">
<link rel="import" href="sig-access-list.html">
<link rel="import" href="sig-accounting-list.html">
<link rel="import" href="sig-http-list.html">

<dom-module id="sig-app">
	<template is="dom-bind">
		<style is="custom-style">
			:root {
				@apply(--paper-font-common-base);
			}
			app-header {
				color: #fff;
			}
			app-toolbar {
            background: var(--paper-orange-500);
         }
			app-drawer {
				--app-drawer-content-container: {
					padding-top: 10px;
				};
				height: 100%;
				top: 64px;
			}
			paper-progress {
				display: block;
				width: 100%;
				--paper-progress-active-color: var(--paper-orange-50);
				--paper-progress-container-color: transparent;
			}
			iron-pages {
				height: 100%;
			}
		</style>
		<app-header-layout>
			<app-header>
				<app-toolbar>
					<paper-icon-button
							icon="menu"
							onclick="drawer.toggle()">
						</paper-icon-button>
						<div main-title>Online Charging System (OCS)</div>
						<paper-icon-button
								id="refresh"
								icon="refresh"
								on-click="refresh">
						</paper-icon-button>
						<paper-icon-button
								id="download"
								icon="file-download"
								on-click="download" >
						</paper-icon-button>
						<paper-progress
								id="progress"
								value="0"
								indeterminate
								bottom-item
								disabled="true">
						</paper-progress>
					</app-toolbar>
				</app-header>
				<iron-pages
						id="loadPage"
						role="main">
					<sig-sub-list></sig-sub-list>
					<sig-client-list></sig-client-list>
					<sig-ipdr-list></sig-ipdr-list>
					<sig-access-list></sig-access-list>
					<sig-accounting-list></sig-accounting-list>
					<sig-http-list></sig-http-list>
				</iron-pages>
				<app-drawer-layout>
					<app-drawer
							id="drawer"
							swipeOpen>
						<iron-selector
								id="pageSelection"
								class="drawer-list"
								role="navigation">
							<paper-menu id="menu">
								<paper-item
										id="page0"
										onclick="drawer.toggle()"
										class="menuitem">
									<iron-icon icon ="device:devices"></iron-icon>
									&nbsp Subscribers
								</paper-item>
								<paper-item
										id="page1"
										onclick="drawer.toggle()"
										class="menuitem">
									<iron-icon icon ="hardware:router"></iron-icon>
								&nbsp Clients
								</paper-item>
								<paper-submenu>
								<paper-item
										class="menu-trigger menuitem">
									<iron-icon icon ="icons:history"></iron-icon>
									&nbsp Logs
								</paper-item>
								<paper-menu class="menu-content" >
									<paper-item
											id="page3"
											onclick="drawer.toggle()"
											class="menuitem">
											&nbsp &nbsp
										<iron-icon icon ="icons:perm-identity"></iron-icon>
										&nbsp Access
									</paper-item>
									<paper-item
											id="page4"
											onclick="drawer.toggle()"
											class="menuitem">
											&nbsp &nbsp
										<iron-icon icon ="device:data-usage"></iron-icon>
										&nbsp Accounting
									</paper-item>
									<paper-item
											id="page2"
											onclick="drawer.toggle()"
											class="menuitem">
											&nbsp &nbsp
										<iron-icon icon ="device:data-usage"></iron-icon>
										&nbsp IPDR
									</paper-item>
									<paper-item
											id="page5"
											onclick="drawer.toggle()"
											class="menuitem">
											&nbsp &nbsp
										<iron-icon icon ="device:data-usage"></iron-icon>
										&nbsp HTTP
									</paper-item>
								</paper-menu>
							</paper-submenu>
						</paper-menu>
					</iron-selector>
				</app-drawer>
			</app-drawer-layout>
		</app-header-layout>
		<!--Modal Definitions-->
		<sig-sub-add></sig-sub-add>
		<sig-sub-update></sig-sub-update>
		<sig-client-add></sig-client-add>
		<sig-client-update></sig-client-update>
		<sig-ipdr-log-files></sig-ipdr-log-files>
	</template>
	<script>
		Polymer (
			{
				is: 'sig-app',
				listeners: {
					'pageSelection.iron-select': 'loadElement'
				},
				loadElement: function(event) {
					switch(event.detail.item.getAttribute('id')) {
						case 'page0':
							this.$.loadPage.selected = 0;
							break;
						case 'page1':
							this.$.loadPage.selected = 1;
							break;
						case 'page2':
							this.$.loadPage.selected = 2;
							document.getElementById("selectLogFileModal").open();
							break;
						case 'page3':
							this.$.loadPage.selected = 3;
							break;
						case 'page4':
							this.$.loadPage.selected = 4;
							break;
						case 'page5':
							this.$.loadPage.selected = 5;
							break;
					}
				},
				refresh: function() {
					if(this.$.loadPage.selected == 0){
						document.getElementById('getSubs').generateRequest();
					 }
					if(this.$.loadPage.selected == 1){
						document.getElementById('getClients').generateRequest();
					 }
					if(this.$.loadPage.selected == 3){
						document.getElementById('getAccess').generateRequest();
					 }
					if(this.$.loadPage.selected == 4){
						document.getElementById('getAccounting').generateRequest();
					 }
					if(this.$.loadPage.selected == 5){
						document.getElementById('getHttp').generateRequest();
					 }
				},
				download: function() {
					var csvObject = new Object();
					if(this.$.pageSelection.selected == 0) {
						var data = document.getElementById("subscriberGrid").items;
						csvObject.gridData = data;
						csvObject.headers = "Identity, Secret, Balance, Data Rate, Xmit Rate, Session Timeout," +
								"Accounting Interval, Class, Enabled \n";
						csvObject.keys = [ "id", "password", "balance", "ascendDataRate", "ascendXmitRate", +
								"sessionTimeout", "acctInterimInterval", "class", "enabled"];
						csvObject.fileName = "subscribers.csv";
					}
					if(this.$.pageSelection.selected == 1) {
						var data = document.getElementById("clientGrid").items;
						csvObject.gridData = data;
						csvObject.headers = "Identity, Secret, Disconnect Port, Protocol\n";
						csvObject.keys = ["id", "secret", "disconnectPort", "protocol"];
						csvObject.fileName = "clients.csv";
					}
					if(this.$.pageSelection.selected == 2) {
						var data = document.getElementById("ipdrGrid").items;
						csvObject.gridData = data;
						csvObject.headers = "IPDR creation time, Sequence Number, Username, Session ID," +
								"Calling Station, Called Station, NAS IP, NAS ID, Session Duration, Input Octets," +
								"Output Octets, Session Start Time, Session End Time, Session Terminate \n";
						csvObject.keys = ["ipdrCreationTime", "seqNum", "username", "acctSessionId", +
								"callingStationId", "calledStationId", "nasIpAddress", "nasId", "sessionDuration" +
								"inputOctets", "outputOctets", "gmtSessionStartDateTime", "gmtSessionEndDateTime" +
								"sessionTerminateCause"];
						csvObject.fileName = "usage_logs.csv";
					}
					generateCSVData(csvObject);
				}
			}
		);
		function generateCSVData(csvObject) {
			var csvData = "data:text/csv;charset=utf-8,";
			csvData += csvObject.headers;
			csvObject.gridData.forEach(
				function(row, index) {
					var dataLine = "";
					csvObject.keys.forEach(
						function(key, i) {
							dataLine += row[key] + ",";
						}
					);
					dataLine += "\n";
					csvData += dataLine;
				}
			);
			var encodedUri = encodeURI(csvData);
			var link = document.createElement("a");
			link.setAttribute("href", encodedUri);
			link.setAttribute("download", csvObject.fileName);
			document.body.appendChild(link);
			link.click();
		}
		</script>
</dom-module>
