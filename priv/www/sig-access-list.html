<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="bower_components/vaadin-grid/vaadin-grid-filter.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">

<dom-module id="sig-access-list">
	<style>
		::-webkit-input-placeholder { /* Chrome/Opera/Safari */
			color: initial;
			font-weight: bold;
		}
		::-moz-placeholder { /* Firefox 19+ */
			color: initial;
			font-weight: bold;
		}
		:-ms-input-placeholder { /* IE 10+ */
			color: initial;
			font-weight: bold;
		}
		:-moz-placeholder { /* Firefox 18- */
			color: initial;
			font-weight: bold;
		}
		vaadin-grid {
			height: 100vh;
			--vaadin-grid-header-cell: {
				background: #ffb04c;
			};
		}
		vaadin-grid input {
			font-size: inherit;
			background: #ffb04c;
			border-style: none;
		}
	</style>
	<template>
		<vaadin-grid id="accessGrid" >
			<vaadin-grid-column width="24ex">
				<template class="header">
					<vaadin-grid-sorter path="timeStamp">
						<vaadin-grid-filter aria-label="TimeStamp" path="timeStamp" value="[[_filterTimeStamp]]">
							<input placeholder="Time Stamp" value="{{_filterTimeStamp::input}}" focus-target>
						</vaadin-grid-filter>
					</vaadin-grid-sorter>
				</template>
				<template>[[item.timeStamp]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="18ex" flex-grow="4">
				<template class="header">
					<vaadin-grid-sorter path="username">
						<vaadin-grid-filter aria-label="UserName" path="username" value="[[_filterUserName]]">
							<input placeholder="User Name" value="{{_filterUserName::input}}" focus-target>
						</vaadin-grid-filter>
					</vaadin-grid-sorter>
				</template>
				<template>[[item.username]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="15ex" flex-grow="3">
				<template class="header">
					<vaadin-grid-sorter path="serverAddress">
						<vaadin-grid-filter aria-label="ServerAddress" path="serverAddress" value="[[_filterServerAddress]]">
							<input placeholder="Server Address" value="{{_filterServerAddress::input}}" focus-target>
						</vaadin-grid-filter>
					</vaadin-grid-sorter>
				</template>
				<template>[[item.serverAddress]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="5ex" flex-grow="2">
				<template class="header">
					<vaadin-grid-filter aria-label="ServerPort" path="serverPort" value="[[_filterServerPort]]">
						<input placeholder="Server Port" value="{{_filterServerPort::input}}" focus-target>
					</vaadin-grid-filter>
				</template>
				<template>[[item.serverPort]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="8ex" flex-grow="0">
				<template class="header">
					<vaadin-grid-filter aria-label="Type" path="type" value="[[_filterType]]">
						<input placeholder="Type" value="{{_filterType::input}}" focus-target>
					</vaadin-grid-filter>
				</template>
				<template>[[item.type]]</template>
			</vaadin-grid-column>
		</vaadin-grid>
		<iron-ajax id="getAccess"
				auto = false
				url="/ocs/v1/log/access"
				method = "GET"
				headers='{"Accept": "application/json"}'
				on-loading-changed="_onLoadingChanged"
				on-response="responseHandler"
				debounce-duration="10">
		</iron-ajax>
	</template>
	<script>
		Polymer (
			{
				is: 'sig-access-list',
				responseHandler: function(event) {
					var grid = this.$.accessGrid;
					var results = event.detail.xhr.response;
					var vaadinItems = new Array();
					for (var index in results) {
						var newRecord = new Object();
						newRecord.timeStamp = results[index].timeStamp;
						newRecord.username = results[index].username;
						newRecord.serverAddress = results[index].serverAddress;
						newRecord.serverPort = results[index].serverPort;
						newRecord.type = results[index].type;
						vaadinItems[index] = newRecord;
					}
					grid.items = vaadinItems;
					grid.visibleRows= vaadinItems.length;
					grid.frozenColumns = 2;
					grid.columns = [
						{
							name: "timeStamp"
						},
						{
							name: "username"
						},
						{
							name: "serverAddress"
						},
						{
							name: "serverPort"
						},
						{
							name: "type"
						}
					];
				},
				_onLoadingChanged: function(event) {
					if (document.getElementById("getAccess").loading) {
						document.getElementById("progress").disabled = false;
					} else {
						document.getElementById("progress").disabled = true;
					}
				}
			}
		);
	</script>
</dom-module>
